# SquidFW: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∫—Å–∏-–∫–ª–∞—Å—Ç–µ—Ä–∞

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–∞ –±–∞–∑–µ **Squid**, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **HTTPS Intercept**, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –ø–æ –¥–æ–º–µ–Ω–∞–º, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

---

## üìö –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
    
- üìà –í–∞—Ä–∏–∞–Ω—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (`NODE_TYPE`)
    
- üìÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
    
- üîß –ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    
- ‚öñÔ∏è –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ (—Ä–µ–∂–∏–º 4)
    
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    
- üöÄ Docker
    
- üîó –ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
    
- üåê –≠—Ç–∞–ª–æ–Ω–Ω–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è

- üõ†Ô∏è Gitlab ci


---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTTPS (Intercept)
    
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –ø–æ –¥–æ–º–µ–Ω–∞–º: —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
    
- –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Keepalived (VRRP)
    
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–∞–Ω–∞–ª–∞
    
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –ª–æ–≥–æ–≤ (rsyslog)
    
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Consul
	
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å –ø–æ–º–æ—â—å—é netdata (–í —Ä–µ–∂–∏–º–µ stream)
	
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–µ—Ç–µ–≤—ã–º –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–æ–º ClamAV (—á–µ—Ä–µ–∑ ICAP)
    

---

## üìà –í–∞—Ä–∏–∞–Ω—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (`NODE_TYPE`)

|NODE_TYPE|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã|
|---|---|---|
|1|–ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞|Squid + Redsocks|
|2|Master-–Ω–æ–¥–∞ —Å VRRP|Squid + Redsocks + Keepalived|
|3|Backup-–Ω–æ–¥–∞ VRRP|Squid + Redsocks + Keepalived|
|4|–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏|Squid —Å cache_peer|
|5|–°–µ—Ç–µ–≤–æ–π –∞–Ω—Ç–∏–≤–∏—Ä—É—Å|ClamAV + ICAP|

---

## üìÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **ALT Linux P10** (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ALT JEOS P10)
    
- –°–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ Squid —Å –ø–∞—Ç—á–∞–º–∏
    
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–∏ `.rpm` –ø–∞–∫–µ—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, —Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞–∫–µ—Ç—ã squid –∏ squid_helpers –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¥–∞–Ω–Ω–æ–π [—Å—Ç–∞—Ç—å–µ–π](https://habr.com/ru/articles/267851/). –ü–æ—Å–ª–µ —É–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

```
SQUID_LINK="<—Å—Å—ã–ª–∫–∞ –Ω–∞ squid rpm>"
SQUID_HELPER_LINK="<—Å—Å—ã–ª–∫–∞ –Ω–∞ helpers rpm>"
```

---

## üîß –ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–∫—Ä–∏–ø—Ç–∞ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª, –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–∏–ø–æ–º —É—Å—Ç–∞–Ω–æ–≤–∫–∏(NODE_TYPE):

–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã–Ω–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ (–∫—Ä–æ–º–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞) –¥–ª—è –≤—Å–µ—Ö:

```
HOME_NET='192.168.0.0/16'
NODE_TYPE= #1 for single install, 2 for vrrp Master, 3 for vrrp Backup, 4 for LoadBalancer, 5 for ClamAv network antivirus

# –ü–∞–∫–µ—Ç—ã
SQUID_LINK='https://.../squid.rpm'
SQUID_HELPER_LINK='https://.../squid-helpers.rpm'

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
RSYSLOG_INSTALL=0 #Set 1 or 0
RSYSLOG_COMMAND=''
SQUIDANALYZER=0 #Install darold/squidanalyzer on node (if rsyslog_install=1)
NETDATA_INSTALL=0 #Install netdata child with streaming on parent
NETDATA_DEST=''
NETDATA_API=''
```

### üîπ NODE_TYPE 1:
–í –¥–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 –Ω–æ–¥–∞. –í—Å–µ –∫–æ–Ω—Ñ–∏–≥–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ cli –º–∞—à–∏–Ω—ã. –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –µ–µ —É–∫–∞–∑–∞—Ç—å –∫–∞–∫ —à–ª—é–∑.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –¥–ª—è —Ç–∏–ø–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ 1:

```
INTERNAL_NET='10.10.10.0/24' #ONLY /24 PREFIX

PROXY_IP=
PROXY_PORT=
PROXY_LOGIN=
PROXY_PASSWORD=
RU_SITES="
.vk.com
"
PROXY_SITES="
.com
"
```

### üîπ NODE_TYPE 2:
–í –¥–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è main –Ω–æ–¥–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª—é–±–æ–µ* –∫–æ–ª-–≤–æ –Ω–æ–¥, –Ω–æ –Ω–∏–∫–∞–∫–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–µ –±—É–¥–µ—Ç. –ù–æ–¥–∞ 2 —Ç–∏–ø–∞ –±—É–¥–µ—Ç –≥–ª–∞–≤–Ω–æ–π, –∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–Ω–∞—è –Ω–æ–¥–∞ 3 —Ç–∏–ø–∞ - –±—É–¥–µ—Ç –±—ç–∫–∞–ø–æ–º. –ù–ê –∫–ª–∏–µ–Ω—Ç–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —à–ª—é–∑–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å vrrp ip.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –¥–ª—è —Ç–∏–ø–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ 2:

```
INTERNAL_NET='10.10.10.0/24' #ONLY /24 PREFIX

PROXY_IP=
PROXY_PORT=
PROXY_LOGIN=
PROXY_PASSWORD=
RU_SITES="
.vk.com
"
PROXY_SITES="
.com
"

KEEPALIVED_VIP= #HA ip
```

### üîπ NODE_TYPE 3:
–î–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º "–≤–æ—Ä–∫–µ—Ä–æ–º", –∫–æ–Ω–µ–∫—Ç–∏—Ç—Å—è –∫ 2 –∏–ª–∏ 4 —Ç–∏–ø–∞–º –Ω–æ–¥, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –Ω–∏—Ö. –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–≤–æ–≥–æ "–≤–æ—Ä–∫–µ—Ä–∞" –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ RU_SITES –∏ PROXY_SITES, –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö - –Ω–µ –Ω—É–∂–Ω–æ (–ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–≤–ª—è—Ç—å –∏—Ö –ø—É—Å—Ç—ã–º–∏). –î–∞–ª–µ–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤  consul.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –¥–ª—è —Ç–∏–ø–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ 3:

```
INTERNAL_NET='10.10.10.0/24' #ONLY /24 PREFIX

PROXY_IP=
PROXY_PORT=
PROXY_LOGIN=
PROXY_PASSWORD=
RU_SITES="
.vk.com
"
PROXY_SITES="
.com
"

KEEPALIVED_VIP= #HA ip
KEEPALIVED_PASSWORD=password #Password for link Backup nodes

#SET LB_SERVER and CONSUL_ENCRYPT FOR 3 NODE TYPE, if need to connect to node 4 type
LB_SERVER=
CONSUL_ENCRYPT=''
```

### üîπ NODE_TYPE 4:
–î–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç squid –≤ —Ä–µ–∂–∏–º–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞ squid_peer, –∏—Å–ø–æ–ª—å–∑—É—è weight (–¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏, —É—á–∏—Ç—ã–≤–∞—è –∫–∞–Ω–∞–ª –ø—Ä–æ–∫—Å–∏). –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è vrrp ip.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –¥–ª—è —Ç–∏–ø–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ 4:

```
KEEPALIVED_VIP= #HA ip
KEEPALIVED_PASSWORD=password #Password for link Backup nodes
```
–í –∫–æ–Ω—Ü–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω consul encrypt –∫–ª—é—á, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –Ω–æ–¥ –≤ consul. 

### üîπ NODE_TYPE 5:
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ clamav –≤ —Ä–µ–∂–∏–º–µ —Å–µ—Ç–µ–≤–æ–≥–æ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º icap –∏ squid. –ï—Å–ª–∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–∫—Å–∏-–∫–ª–∞—Å—Ç–µ—Ä–µ, —Ç–æ –Ω–µ–æ–±—Ö–∑–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```
NEW_GATEWAY=
LB_SERVER=
CONSUL_ENCRYPT=''
```

–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç CA (–≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏) –∏ ip –∞–¥—Ä–µ—Å –¥–∞–Ω–Ω–æ–π –Ω–æ–¥—ã.

---

## ‚öñÔ∏è –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ (—Ä–µ–∂–∏–º 4)

–ù–æ–¥–∞ —Ç–∏–ø–∞ 4 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç `weight` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞ —á–µ—Ä–µ–∑ `speedtest-cli` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ Consul.

### ‚úçÔ∏è –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:

```
consul kv put squid/clients/$NET_IP/weight 75
```

> –í —Ü–µ–ª–æ–º weight - –ª—é–±–æ–µ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–æ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è —á—Ç–æ —ç—Ç–æ —Å–∫–æ—Ä–æ—Å—Ç—å –∫–∞–Ω–∞–ª–∞ –ø—Ä–æ–∫—Å–∏.


### üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VRRP –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤:

```
consul kv put squid/clients/$NET_IP/priority 241
```

> Keepalived –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç 1 –¥–æ 255

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è `redsocks` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ `curl --interface $INTERNAL_NET_IP` http://ifconfig.me. –í —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–æ –±—É–¥–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ redsocks, –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –Ω–æ–¥–µ, –≤ —Å—Ç–∞—Ç—É—Å–µ failed.
    

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Consul
  –í–µ–±–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É http://$LB_SERVER:8500
  –ü—Ä–∏–≤–µ—Ä–Ω–æ –≤–æ—Ç —Ç–∞–∫ –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–µ—Ä–≤–∏—Å—ã:
  <img width="1480" height="539" alt="Pasted image 20250729175553" src="https://github.com/user-attachments/assets/9a72ad1d-9056-44d1-84ad-4d39dfaa6616" />

### üìÑ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –ª–æ–≥–æ–≤:

```
RSYSLOG_INSTALL=1
RSYSLOG_COMMAND='*.* @@192.168.123.123'
```

–ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å **LogAnalyzer** –∫ rsyslog-—Å–µ—Ä–≤–µ—Ä—É, —á—Ç–æ –±—ã –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ª–æ–≥–∏ –≤ –≤–µ–±–µ:
<img width="1869" height="1299" alt="Pasted image 20250729175241" src="https://github.com/user-attachments/assets/241894dd-e846-431b-86cd-533e9cdb3da9" />


### ‚è±Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ–º–æ—â—å—é netdata

```
NETDATA_INSTALL=1 #Install netdata child with streaming on parent
NETDATA_DEST='192.168.12.1'
NETDATA_API=''
```

–° –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π parent —Å–µ—Ä–≤–µ—Ä–∞ netdata –º–æ–∂–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—Å—è –ø–æ [—Å—Å—ã–ª–∫–µ](https://staging1--netdata-docusaurus.netlify.app/docs/streaming/streaming-configuration-reference). –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è api –∫–ª—é—á–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É:
`cat /opt/netdata/var/lib/netdata/netdata.api.key`

---

## üöÄ Docker

–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–¥—É —Ç–∏–ø–∞ 1 –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. –¢—Ä–µ–±—É–µ—Ç—Å—è:

- `--network host`
    
- `--privileged`
    
- –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ `-p 3228:3228`
    

–ü—Ä–∏–º–µ—Ä Dockerfile –∏ —Å–∫—Ä–∏–ø—Ç: [SquidFW Docker](https://github.com/govorunov-av/SquidFW/tree/main/docker)

> ‚ùå Keepalived –≤ Docker-—Ä–µ–∂–∏–º–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è!

–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ —É–∫–∞–∑–∞—Ç—å ip –Ω–æ–¥—ã —Å docker –≤ –∫–∞—á–µ—Å—Ç–≤–µ —à–ª—é–∑–∞.


---

## üõ†Ô∏è Gitlab ci

–î–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å gitlab ci.

–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–æ—Ä–∫–µ—Ä–∞, –≤ —Ä–µ–∂–∏–º–µ shell.
–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–∞ –Ω–∞ altlinux –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```
apt-get update
apt-get install git gitlab-runner -y 
userdel gitlab-runner 
rm -rf /var/lib/gitlab-runner/
useradd gitlab-runner 
echo 'gitlab-runner ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers
usermod -aG wheel gitlab-runner 
gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner
gitlab-runner start
gitlab-runner register
```
–î–∞–ª–µ–µ –∫–∞–∫ –∏ –æ–±—ã—á–Ω–æ, –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞–Ω–Ω–µ—Ä–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–≥, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–∞–Ω–Ω–µ—Ä–∞
`gitlab-runner register`

–ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã —Ä—É–∫–∞–º–∏.
–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ - –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å 1 —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ç–æ–∫, –ø–æ –≤–µ—Ç–∫–µ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã. 
–¢–µ–≥ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ñ–∞–π–ª–µ .gitlab-ci.yml
```
default:
    tags: 
        - <tag>
```

–¢–µ–º —Å–∞–º—ã–º, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤ —Ñ–∞–π–ª–∞—Ö –≤–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∏–∑–æ–π–¥—É—Ç –Ω–∞ –Ω–æ–¥–µ.
<img width="558" height="128" alt="Pasted image 20250729175129" src="https://github.com/user-attachments/assets/771a4865-c3b8-44f4-b432-f29490be508d" />


---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [Intercept HTTPS —Å –ø–æ–º–æ—â—å—é Squid (Habr)](https://habr.com/ru/articles/267851/)
    
- [–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ (Habr)](https://habr.com/ru/articles/272733/)
	
- [Streaming and replication reference](https://staging1--netdata-docusaurus.netlify.app/docs/streaming/streaming-configuration-reference)
	
-  [SquidAnalyzer](https://github.com/darold/squidanalyzer/tree/master)
	

---

## üåê –≠—Ç–∞–ª–æ–Ω–Ω–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è

–î–æ 10 –≤–æ—Ä–∫–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏", –±–æ–ª—å—à–µ ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VRRP –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞.

–≠—Ç–∞–ª–æ–Ω–Ω–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
<img width="1593" height="931" alt="Pasted image 20250729170519" src="https://github.com/user-attachments/assets/36cd2230-7eae-4a02-8c94-c8fd83d5e96d" />



---

> üí¨ –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Å–∫—Ä–∏–ø—Ç–∞ –∏–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

---

¬© 2023-2025 govorunov-av. Licensed under GNU GPL v3.0.
